---
layout: post
status: publish
published: true
title: 'HOWTO: Come sostituire in disco rotto da un RAID software su linux'
author:
  display_name: diegor
  login: diegor
  email: me@diegor.it
  url: http://www.diegor.it
author_login: diegor
author_email: me@diegor.it
author_url: http://www.diegor.it
wordpress_id: 2215
wordpress_url: http://www.diegor.it/?p=2215
date: '2010-02-18 17:31:00 +0000'
date_gmt: '2010-02-18 16:31:00 +0000'
categories:
- linux
- friends
- various links
- job
- howto
tags:
- howto
comments: []
---
<p>Se sei un sysadmin oppure ti piace smanettare con linux + dischi + <a href="http://en.wikipedia.org/wiki/RAID">RAID</a> questo howto ti potrebbe essere molto utile. Se hai un <a href="http://en.wikipedia.org/wiki/RAID">RAID</a>, qualunque tipo esso sia, questo howto ti indica come procedere nel sostituire il disco rotto di un RAID. Ovviamente se un disco si rompe, il RAID pu&ograve; decidere autonomamente di espellerlo da solo. A volte questo non succede e lo si deve fare a mano. Ecco come:</p>
<p><strong>Supponiamo che il disco da rimuovere sia /dev/sda</strong></p>
<ol>
<li>Manda in stato di fail il disco su tutte le partizioni in cui &egrave; coinvolto (qui nell'esempio 3 partizioni):
<pre>mdadm /dev/md0 --fail /dev/sda1<br />
mdadm /dev/md1 --fail /dev/sda2<br />
mdadm /dev/md2 --fail /dev/sda3</pre><br />
</li></p>
<li>Attendi il resync (questa operazione pu&ograve; richiedere molto tempo) tramite:<br />
cat /proc/mdstats</li></p>
<li>Rimuovi dal RAID il disco rotto:
<pre>mdadm /dev/md0 --remove /dev/sda1<br />
mdadm /dev/md1 --remove /dev/sda2<br />
mdadm /dev/md2 --remove /dev/sda3</pre><br />
</li></p>
<li>Estrai il disco /dev/sda</li>
<li>Copia l'MBR (uguale su tutti i dischi) in un file:
<pre>dd if=/dev/sda of=mbr bs=512 count=1</pre><br />
</li></p>
<li>Inserisci il nuovo disco</li>
<li>Copia l'MBR sul nuovo disco appena inserito:
<pre>dd if=mbr of=/dev/sdf</pre><br />
</li></p>
<li>Immetti il nuovo disco nel RAID:
<pre>mdadm /dev/md0 --re-add /dev/sdf1<br />
mdadm /dev/md1 --re-add /dev/sdf2<br />
mdadm /dev/md2 --re-add /dev/sdf3</pre><br />
</li></p>
<li>Ora il disco appena inserito prender&agrave; il ruolo di quello rotto.</li><br />
</ol><br />
Se hai suggerimenti, problemi, domande, commenta il post oppure <a href="http://www.diegor.it/chi-e-diegor/">contattami</a>! :)</p>
<p><em>Autore originale: </em><a href="http://twitter.com/l_allegrucci"><em>Lorenzo</em></a></p>
